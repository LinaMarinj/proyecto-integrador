<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empleados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="gestionEmpleados.css">
    <script src="../../../assets/js/particles.js"></script>
</head>


<body class="flex">


    <style>
        .menu-hidden {
            width: 8rem;
        }

        .menu-hidden .option-menu {
            display: none;
        }

        .menu-expanded {
            width: 18rem;
        }
    </style>

    <!-- Menú lateral -->
    <div class="h-screen">
        <div id="sidebar" class="menu-expanded h-screen p-4 text-white transition-all duration-300 relative">
            <div id="particles-js" class="absolute h-full left-0 lg:w-1/2 md:w-full z-10"></div>
            <div class="bg-blue-800 rounded-lg h-full relative">
                <div class="p-4 flex flex-wrap items-center relative z-10">
                    <img class="w-20 p-3" src="../../../assets/img/logomenu.png" alt="">
                    <span class="font-bold my-4 text-center">Nómina Solutions</span>
                </div>
                <ul class="space-y-2 px-4 relative z-10">
                    <li>
                        <a href="../admin1.html">
                            <button class="text-left px-4 py-2 flex items-center justify-between hover:bg-blue-700"
                                onclick="toggleDropdown('menu1')">
                                <span class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home"
                                        width="24" height="24" viewBox="0 0 24 24" stroke-width="2"
                                        stroke="currentColor" fill="none" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <path d="M5 12l-2 0l9 -9l9 9l-2 0" />
                                        <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
                                        <path d="M9 21h6" />
                                    </svg>

                                    <span class="ml-4 option-menu">Inicio</span>
                                </span>
                            </button>
                        </a>
                    </li>
                    <li>
                        <a href="gestionEmpleados.html">
                            <button class="text-left px-4 py-2 flex items-center justify-between hover:bg-blue-700"
                                onclick="toggleDropdown('menu2')">
                                <span class="flex items-center">
                                    <span class="inline-block w-6 h-6">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="icon icon-tabler icon-tabler-user" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <circle cx="12" cy="7" r="4" />
                                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                                        </svg>
                                    </span>
                                    <span class="ml-4 option-menu">Empleados</span>
                                </span>
                            </button>
                        </a>

                    </li>
                    <li>
                        <a href="../../../index.html">
                            <button class="text-left px-4 py-2 flex items-center justify-between hover:bg-blue-700"
                                onclick="toggleDropdown('menu4')">
                                <span class="flex items-center">
                                    <span class="inline-block w-6 h-6">
                                        <svg xmlns="http://www.w3.org/2000/svg"
                                            class="icon icon-tabler icon-tabler-logout" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <path
                                                d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2" />
                                            <path d="M7 12h14l-3 -3m0 6l3 -3" />
                                        </svg>
                                    </span>
                                    <span class="ml-4 option-menu">Cerrar sesión</span>
                                </span>
                            </button>
                        </a>

                    </li>

                </ul>
                <div class="p-6 flex justify-center relative z-10">
                    <button onclick="toggleMenu()" id="toggleButton"
                        class="bg-blue-600 text-white p-2 rounded-full focus:outline-none">
                        &lt;
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            const sidebar = document.querySelector('#sidebar');
            sidebar.classList.toggle('menu-expanded');
            sidebar.classList.toggle('menu-hidden');
            document.querySelector('#toggleButton').textContent = sidebar.classList.contains('menu-expanded') ? '<' : '>';
        }
    </script>




    <section class="flex  flex-wrap">

        <div class="w-full mt-10">
            <section class="flex flex-wrap justify-between">
                <h1 class="text-black text-3xl font-bold tracking-wide">Gestion De Empleados</h1>
                <a href="anadirEmpleado.html">
                    <button id="botonNuevoEmpleado"
                        class="flex font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-4"
                        type="submit">Añadir empleado <img src="../../../assets/img/plus.png" class="w-6 ml-2">
                    </button>
                </a>
            </section>

            <hr class="mt-4">

        </div>

        <div id="content">

            <table class="min-w-full divide-y divide-gray-200 bg-white border rounded mt-4">
                <thead class="bg-white divide-y divide-gray-100">

                    <tr>

                        <th class="px-6 py-3 text-left text-sm font-bold text-gray-700 uppercase tracking-wider">
                            Documento </th>

                        <th class="px-6 py-3  text-left text-sm font-bold text-gray-700 uppercase tracking-wider">
                            Empleado</th>

                        <th class="px-6 py-3  text-left text-sm font-bold text-gray-700 uppercase tracking-wider">
                            Cargo</th>
                        <th class="px-6 py-3  text-left text-sm font-bold text-gray-700 uppercase tracking-wider">
                            Tipo contrato</th>
                        <th class="px-6 py-3  text-left text-sm font-bold text-gray-700 uppercase tracking-wider">
                            Acción</th>
                    </tr>
                </thead>

                <tbody class=" divide-y divide-gray-100 px-6">

                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">1122334455</td>
                        <td class="flex items-center">
                            <div class="w-8 h-8 bg-gray-200 rounded-full">
                                <img src="../../../assets/img/masculino.png" alt="M">
                            </div>

                            <div class="px-6 py-4 whitespace-nowrap">
                                Juan Camilo Puerta
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">Aux. contable</td>
                        <td class="px-6 py-4 whitespace-nowrap">Indefinido</td>
                        <td>
                            <a href="empleado1.html">
                                <button class="botonInforEmpleado text-black py-2 px-4 rounded border">
                                    <img src="../../../assets/img/selec.png" alt="Icono" class="inline-block h-4 w-4">

                                </button>
                            </a>

                            <button onclick="abrirModalLiquidacion()"
                                class="botonliquidar text-black py-2 px-4 rounded border">
                                <img src="../../../assets/img/icono-liquidar.webp" alt="Liquidar"
                                    class="inline-block h-4 w-4">
                            </button>
                        </td>


                    </tr>

                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">12345678</td>
                        <td class="flex items-center">
                            <div class="w-8 h-8 bg-gray-200 rounded-full">
                                <img src="../../../assets/img/femenino.png" alt="F">
                            </div>

                            <div class="px-6 py-4 whitespace-nowrap">
                                María Camila Lopez
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">Aprendiz R.H</td>
                        <td class="px-6 py-4 whitespace-nowrap">Fijo</td>

                        <td>
                            <a href="empleado2.html">
                                <button class="botonInforEmpleado text-black py-2 px-4 rounded border">
                                    <img src="../../../assets/img/selec.png" alt="Icono" class="inline-block h-4 w-4">

                                </button>
                            </a>

                            <button onclick="abrirModalLiquidacion()"
                                class="botonliquidar text-black py-2 px-4 rounded border">
                                <img src="../../../assets/img/icono-liquidar.webp" alt="Liquidar"
                                    class="inline-block h-4 w-4">
                            </button>
                        </td>

                    </tr>


                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">987654321</td>
                        <td class="flex items-center">
                            <div class="w-8 h-8 bg-gray-200 rounded-full">
                                <img src="../../../assets/img/masculino.png" alt="M">
                            </div>

                            <div class="px-6 py-4 whitespace-nowrap">
                                Sebastian Castillo
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">Aux. contable</td>
                        <td class="px-6 py-4 whitespace-nowrap">Indefinido</td>
                        <td>
                            <a href="empleado3.html">
                                <button class="botonInforEmpleado text-black py-2 px-4 rounded border">
                                    <img src="../../../assets/img/selec.png" alt="Icono" class="inline-block h-4 w-4">

                                </button>
                            </a>
                            <button onclick="abrirModalLiquidacion()"
                                class="botonliquidar text-black py-2 px-4 rounded border">
                                <img src="../../../assets/img/icono-liquidar.webp" alt="Liquidar"
                                    class="inline-block h-4 w-4">

                            </button>


                        </td>

                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    </main>




    <div id="myModal" class="modal">

        <div class="modal-content">
            <div class="flex justify-center flex-wrap">

                <section id="formularioLiquidacion"
                    class="contenedorLiquidar w-full max-w-lg bg-white p-8 rounded-lg z-10 mx-auto">
                    <div class="w-full">
                        <h1 style="font-weight: bold; font-size: 22px;" class="text-black flex justify-center">
                            Liquidación Empleado</h1>
                        <hr class="mt-4">
                    </div>
                    <form action="#">
                        <div class="flex justify-between mb-4 my-14">
                            <div>
                                <label for="fecha_ingreso" class="block"><strong>*Fecha de ingreso:</strong></label>
                                <input type="date" id="fecha_ingreso" name="fecha_ingreso" required
                                    class="border rounded w-full p-2">
                            </div>
                            <div>
                                <label for="fecha_salida" class="block"><strong>*Fecha de salida:</strong></label>
                                <input type="date" id="fecha_salida" name="fecha_salida" required
                                    class="border rounded w-full p-2">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="salario_mensual" class="block"><strong>*Salario mensual:</strong></label>
                            <input type="number" id="salario_mensual" name="salario_mensual" required
                                class="border rounded w-full p-2">
                        </div>

                        <div class="mb-4">
                            <label for="tiene_auxilio_transporte" class="block"><strong>*¿Tiene derecho a auxilio de
                                    transporte?</strong></label>
                            <div class="flex items-center mt-2">
                                <input type="radio" id="tiene_auxilio_transporte_si" name="tiene_auxilio_transporte"
                                    value="si" class="mr-2">
                                <label for="tiene_auxilio_transporte_si" class="mr-4"><strong>SÍ</strong></label>
                                <input type="radio" id="tiene_auxilio_transporte_no" name="tiene_auxilio_transporte"
                                    value="no" class="mr-2">
                                <label for="tiene_auxilio_transporte_no"><strong>NO</strong></label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="razon_salida" class="block"><strong>Razón de la salida:</strong></label>
                            <textarea id="razon_salida" name="razon_salida" rows="4" class="border rounded w-full p-2"
                                required></textarea>
                        </div>

                        <div class="mb-4">
                            <label for="dias_vacaciones" class="block"><strong>*Días de vacaciones
                                    restantes:</strong></label>
                            <input type="number" id="dias_vacaciones" name="dias_vacaciones" min="0" required
                                class="border rounded w-full p-2">
                        </div>

                        <div class="flex items-center justify-center">
                            <button type="button"
                                class="botones font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-4"
                                onclick="calcularLiquidacion()">Liquidar</button>


                            <button onclick="cerrarModalLiquidacion()"
                                class="botones font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                                type="button">Cancelar</button>

                        </div>
                    </form>
                </section>

                <section id="resultadoLiquidacion"
                    class="contenedorLiquidar w-full max-w-lg bg-white p-8 rounded-lg mt-5 z-10 mx-auto">
                    <div class="w-full mt-4">
                        <h1 style="font-weight: bold; font-size: 22px;" class="text-black flex justify-center">
                            Resultados de la
                            Liquidación</h1>
                        <hr class="mt-4">
                    </div>
                    <div id="resultado" class="mt-4 text-center text-black">

                    </div>
                    <div id="dias_trabajados" class="mt-4 text-center text-black">

                    </div>
                    <div id="salario_diario" class="mt-4 text-center text-black">

                    </div>
                    <div id="auxilio_transporte" class="mt-4 text-center text-black">

                    </div>
                    <div id="dias_vacaciones" class="mt-4 text-center text-black">

                    </div>
                    <div class="flex items-center justify-center mt-8">

                        <button onclick="abrirModalLiquidacion()"
                            class="botones font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-4"
                            type="button">Nueva Liquidación</button>


                        <button onclick="cerrarModalLiquidacion()"
                            class="botones font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                            type="button">Cerrar</button>

                    </div>
                </section>
            </div>
        </div>
    </div>


    <script>

        var modal = document.getElementById("myModal");
        var resultadoLiquidacion = document.getElementById("resultadoLiquidacion");
        var formularioLiquidacion = document.getElementById("formularioLiquidacion");

        function abrirModalLiquidacion() {
            modal.style.display = "block";
            resultadoLiquidacion.style.display = "none";
            formularioLiquidacion.style.display = "block";
            document.getElementById('fecha_ingreso').value = "";
            document.getElementById('fecha_salida').value = "";
            document.getElementById('salario_mensual').value = "";
            document.getElementById('dias_vacaciones').value = "";
            document.getElementById('razon_salida').value = "";
        }

        function cerrarModalLiquidacion() {
            modal.style.display = "none";
            resultadoLiquidacion.style.display = "none";
            formularioLiquidacion.style.display = "block";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                cerrarModalLiquidacion();
            }
        }

        function calcularLiquidacion() {

            if (
                !document.getElementById('fecha_ingreso').value ||
                !document.getElementById('fecha_salida').value ||
                !document.getElementById('salario_mensual').value ||
                !document.querySelector('input[name="tiene_auxilio_transporte"]:checked').value ||
                !document.getElementById('dias_vacaciones').value
            ) {
                alert('¡Error!\nCompleta todos los campos');
                return;
            }

            const fechaIngreso = new Date(document.getElementById('fecha_ingreso').value);
            const fechaSalida = new Date(document.getElementById('fecha_salida').value);
            const salarioMensual = parseFloat(document.getElementById('salario_mensual').value);
            const tieneAuxilioTransporte = document.querySelector('input[name="tiene_auxilio_transporte"]:checked').value;
            const diasVacaciones = parseInt(document.getElementById('dias_vacaciones').value);


            const diasTrabajados = (fechaSalida - fechaIngreso) / (1000 * 60 * 60 * 24);
            const salarioDiario = salarioMensual / 30;

            const auxilioTransporteMensual = 140606;
            let auxilioTransporteDiario = 0;
            if (tieneAuxilioTransporte === 'si') {
                auxilioTransporteDiario = auxilioTransporteMensual / 30;
            }

            const liquidacion = (salarioDiario + auxilioTransporteDiario) * diasTrabajados + (salarioDiario * diasVacaciones);

            const formatoCOP = new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP'
            });

            const resultadoFormatted = formatoCOP.format(liquidacion);
            const auxilioTransporteFormatted = formatoCOP.format(auxilioTransporteDiario * diasTrabajados);
            const salarioDiarioFormatted = formatoCOP.format(salarioDiario);


            const queryString = `?resultado=${encodeURIComponent(resultadoFormatted)}` +
                `&dias_trabajados=${encodeURIComponent(diasTrabajados)}` +
                `&salario_diario=${encodeURIComponent(salarioDiarioFormatted)}` +
                `&auxilio_transporte=${encodeURIComponent(auxilioTransporteFormatted)}` +
                `&dias_vacaciones=${encodeURIComponent(diasVacaciones)}`;

            mostrarResultado(
                resultadoFormatted,
                diasTrabajados,
                salarioDiarioFormatted,
                auxilioTransporteFormatted,
                diasVacaciones
            );

            formularioLiquidacion.style.display = "none";
            resultadoLiquidacion.style.display = "block";

        }

        function mostrarResultado(
            resultado,
            diasTrabajados,
            salarioDiario,
            auxilioTransporte,
            diasVacaciones
        ) {
            document.getElementById('resultado').innerHTML = `<strong>La liquidación total es:</strong> ${resultado}`;
            document.getElementById('dias_trabajados').innerHTML = `<strong>Días trabajados:</strong> ${diasTrabajados}`;
            document.getElementById('salario_diario').innerHTML = `<strong>Salario diario:</strong> ${salarioDiario}`;
            document.getElementById('auxilio_transporte').innerHTML = `<strong>Auxilio de transporte:</strong> ${auxilioTransporte}`;
            document.getElementById('dias_vacaciones').innerHTML = `<strong>Días de vacaciones restantes:</strong> ${diasVacaciones}`;
        }
    </script>

    <script src="../../../assets/js/particles-config.js"></script>
</body>

</html>